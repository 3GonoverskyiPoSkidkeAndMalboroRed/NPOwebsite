# Миграция системы пользователей

## Описание изменений

Система пользователей была переработана для привязки ПО к приборам. Теперь регистрация и авторизация происходят по следующим полям:

### Новые поля регистрации:
- **Серийный номер прибора** - уникальный идентификатор прибора
- **ИНН** - ИНН организации
- **КПП** - КПП организации  
- **Пароль** - пароль пользователя
- **ФИО** - полное имя пользователя
- **Должность** - должность пользователя
- **Организация** - название организации
- **Телефон** - контактный телефон
- **Email** - электронная почта

### Новые поля авторизации:
- **Серийный номер прибора**
- **ИНН**
- **КПП**
- **Пароль**

## Валидация серийных номеров

Система проверяет серийные номера по следующим диапазонам:

- **SE02**: 60000-60999
- **SE03 (Спектр-Квант)**: 61000-61999
- **SE03 (SXRAY)**: 62000-62999
- **G**: 6000-6999
- **SW-D3**: 7100-7999
- **MSW**: 8037, 8040, 12000-12999
- **CLSW**: 8000-8036, 8041-8999
- **META**: 11200-11999
- **GVM**: 9000-9300
- **S**: 5001-5999, 9990-9999, 50000-59999, 10000-10999

## Инструкции по миграции

### 1. Остановите приложение
```bash
docker-compose down
```

### 2. Выполните миграцию базы данных
```bash
# Подключитесь к базе данных PostgreSQL
psql -h localhost -U user -d npo_db

# Выполните миграцию
\i migration_update_users.sql
```

### 3. Перезапустите приложение
```bash
docker-compose up -d
```

## Важные замечания

1. **Резервная копия**: Перед миграцией создается резервная копия таблицы `users_backup`
2. **Потеря данных**: Все существующие пользователи будут удалены, так как структура кардинально изменилась
3. **Новые пользователи**: Пользователи должны будут зарегистрироваться заново с новыми полями

## Тестирование

После миграции проверьте:

1. Регистрацию нового пользователя с валидным серийным номером
2. Авторизацию по новым полям
3. Валидацию серийных номеров
4. Отображение информации в профиле пользователя

## Откат изменений

Если необходимо вернуться к старой структуре:

```sql
-- Восстановить данные из резервной копии
DROP TABLE IF EXISTS users;
ALTER TABLE users_backup RENAME TO users;
```
